define(["exports"],function(e){"use strict";class t{constructor(e="keyval-store",t="keyval",r=1){this.dbName=e,this.storeName=t,this._dbp=new Promise((n,o)=>{const s=indexedDB.open(e,r);s.onerror=(()=>o(s.error)),s.onsuccess=(()=>n(s.result)),s.onupgradeneeded=(()=>{s.result.objectStoreNames.contains("keysToExpire")||s.result.createObjectStore("keysToExpire"),s.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(r=>new Promise((n,o)=>{const s=r.transaction(this.storeName,e);s.oncomplete=(()=>n()),s.onabort=s.onerror=(()=>o(s.error)),t(s.objectStore(this.storeName))}))}}let r,n;function o(){return Math.round((new Date).getTime()/1e3)}function s(e,r){return new t(e,r)}function i(){return r||(r=new t),r}function u(e,t=i()){let r;return t._withIDBStore("readonly",t=>{r=t.get(e)}).then(()=>r.result)}function c(e,t=i()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}function a(e=i()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}e.Store=t,e.get=u,e.set=function(e,r,l=i(),h=0){return l._withIDBStore("readwrite",t=>{t.put(r,e)}).then(function(){if(h){let i=(r=l.dbName,n||(n=new t(r,"keysToExpire"),window.setInterval(function(){a(n).then(e=>{let t=o();for(let o of e)u(o,n).then(e=>{let i=e;i&&i.timestamp<t&&(c(i.key,s(r,i.store)),c(o,n))})})},18e4)),n),h={timestamp:o(),store:l.storeName,key:e};e=l.storeName+"_"+e,i._withIDBStore("readwrite",t=>{t.put(h,e)})}var r})},e.del=c,e.clear=function(e=i()){return e._withIDBStore("readwrite",e=>{e.clear()})},e.keys=a,Object.defineProperty(e,"__esModule",{value:!0})});