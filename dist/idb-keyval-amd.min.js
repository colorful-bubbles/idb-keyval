define(["exports"],function(e){"use strict";class t{constructor(e="keyval-store",t="keyval"){this.dbName=e,this.storeName=t,this._dbp=new Promise((r,o)=>{const n=indexedDB.open(e,1);n.onerror=(()=>o(n.error)),n.onsuccess=(()=>r(n.result)),n.onupgradeneeded=(()=>{n.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(r=>new Promise((o,n)=>{const s=r.transaction(this.storeName,e);s.oncomplete=(()=>o()),s.onabort=s.onerror=(()=>n(s.error)),t(s.objectStore(this.storeName))}))}}let r,o;function n(){return Math.round((new Date).getTime()/1e3)}function s(){return r||(r=new t),r}function i(e,t=s()){let r;return t._withIDBStore("readonly",t=>{r=t.get(e)}).then(()=>r.result)}function u(e=s()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}e.Store=t,e.get=i,e.set=function(e,r,c=s(),l=0){return c._withIDBStore("readwrite",t=>{t.put(r,e)}).then(function(){if(l){console.log("setting key to expire"),console.log(c.dbName);let s=(r=c.dbName,o||(o=new t(r,"keysToExpire"),window.setInterval(function(){u(o).then(e=>{n();for(let t of e)i(t,o).then(e=>{console.log(e)})})},18e4)),o);console.log(s);let l={timestamp:n(),store:c.storeName,key:e};e=c.dbName+"_"+e,s._withIDBStore("readwrite",t=>{t.put(l,e)})}var r})},e.del=function(e,t=s()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},e.clear=function(e=s()){return e._withIDBStore("readwrite",e=>{e.clear()})},e.keys=u,Object.defineProperty(e,"__esModule",{value:!0})});